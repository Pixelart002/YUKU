<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vikram's Blog</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Markdown Parser (Marked.js) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: 'Outfit', sans-serif; }
        .prose-content { font-family: 'Merriweather', serif; line-height: 1.8; color: #374151; }
        
        /* Markdown Styles */
        .prose-content h1 { font-size: 2.25rem; font-weight: 800; margin-bottom: 1rem; color: #111827; }
        .prose-content h2 { font-size: 1.8rem; font-weight: 700; margin-top: 2rem; margin-bottom: 1rem; color: #064e3b; }
        .prose-content p { margin-bottom: 1.5rem; font-size: 1.1rem; }
        .prose-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .prose-content blockquote { border-left: 4px solid #10b981; padding-left: 1rem; font-style: italic; color: #4b5563; background: #f0fdf4; padding: 1rem; border-radius: 0 8px 8px 0; }
        .prose-content pre { background: #1f2937; color: #f3f4f6; padding: 1rem; rounded: 0.5rem; overflow-x: auto; margin-bottom: 1.5rem; }
        .prose-content code { background: #e5e7eb; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.9em; color: #dc2626; }
        .prose-content pre code { background: transparent; color: inherit; padding: 0; }
        .prose-content img { border-radius: 0.5rem; margin: 2rem auto; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .prose-content a { color: #059669; text-decoration: underline; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">

    <!-- === HEADER === -->
    <header class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between">
            <div onclick="router.goHome()" class="cursor-pointer flex items-center gap-2 group">
                <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg group-hover:rotate-6 transition">
                    V
                </div>
                <h1 class="text-2xl font-bold tracking-tight text-gray-800">Vikram's <span class="text-emerald-600">Blog</span></h1>
            </div>
            
            <div class="flex items-center gap-4">
                <a href="#" class="text-gray-500 hover:text-emerald-600 transition"><i class="fab fa-twitter text-xl"></i></a>
                <a href="#" class="text-gray-500 hover:text-emerald-600 transition"><i class="fab fa-github text-xl"></i></a>
                <a href="./app.html" class="px-4 py-2 text-sm font-bold text-emerald-600 border border-emerald-200 rounded-full hover:bg-emerald-50 transition">
                    Login
                </a>
            </div>
        </div>
    </header>

    <!-- === MAIN CONTENT AREA === -->
    <main class="flex-1 max-w-6xl mx-auto w-full p-6">
        
        <!-- VIEW 1: POST GRID (HOME) -->
        <div id="view-home" class="animate-fade-in">
            <!-- Hero Section -->
            <div class="text-center py-16">
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Thoughts, Stories & Ideas.</h2>
                <p class="text-gray-500 text-lg max-w-2xl mx-auto">Welcome to my personal space where I share insights about technology, coding, and life.</p>
            </div>

            <!-- Loader -->
            <div id="loader" class="text-center py-20 hidden">
                <div class="inline-block w-8 h-8 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin"></div>
                <p class="mt-2 text-gray-400 text-sm">Loading articles...</p>
            </div>

            <!-- Grid -->
            <div id="posts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-20">
                <!-- JS will inject cards here -->
            </div>
        </div>

        <!-- VIEW 2: SINGLE ARTICLE -->
        <div id="view-article" class="hidden animate-fade-in max-w-4xl mx-auto">
            <button onclick="router.goHome()" class="mb-8 flex items-center gap-2 text-gray-500 hover:text-emerald-600 transition font-medium group">
                <i class="fas fa-arrow-left group-hover:-translate-x-1 transition"></i> Back to Articles
            </button>

            <article class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
                <!-- Cover Image -->
                <div id="article-cover" class="h-64 md:h-96 bg-gray-200 w-full object-cover hidden"></div>
                
                <div class="p-8 md:p-12">
                    <!-- Meta -->
                    <div class="flex items-center gap-4 text-sm text-gray-500 mb-6">
                        <span id="article-date" class="flex items-center gap-1"><i class="far fa-calendar"></i> ...</span>
                        <span id="article-views" class="flex items-center gap-1 text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full"><i class="far fa-eye"></i> ...</span>
                    </div>

                    <!-- Title -->
                    <h1 id="article-title" class="text-3xl md:text-5xl font-bold text-gray-900 mb-8 leading-tight"></h1>

                    <!-- Tags -->
                    <div id="article-tags" class="flex flex-wrap gap-2 mb-10"></div>

                    <!-- Content (Markdown Rendered) -->
                    <div id="article-content" class="prose-content"></div>
                </div>
            </article>
        </div>

    </main>

    <!-- === FOOTER === -->
    <footer class="bg-white border-t border-gray-200 py-10 mt-10">
        <div class="text-center text-gray-400 text-sm">
            <p>&copy; <span id="year"></span> Vikram's Blog. Built with FastAPI & Vanilla JS.</p>
        </div>
    </footer>

    <!-- === LOGIC === -->
    <script>
        const API_BASE_URL = "https://giant-noell-pixelart002-1c1d1fda.koyeb.app"; // Your API URL

        // Router / Navigation Logic
        const router = {
            goHome: () => {
                document.getElementById('view-home').classList.remove('hidden');
                document.getElementById('view-article').classList.add('hidden');
                window.scrollTo(0, 0);
                app.loadPosts();
            },
            goPost: (slug) => {
                document.getElementById('view-home').classList.add('hidden');
                document.getElementById('view-article').classList.remove('hidden');
                window.scrollTo(0, 0);
                app.loadSinglePost(slug);
            }
        };

        const app = {
            init: () => {
                document.getElementById('year').innerText = new Date().getFullYear();
                
                // Check if URL has hash (e.g. #my-first-post)
                const hash = window.location.hash.substring(1);
                if(hash) {
                    router.goPost(hash);
                } else {
                    app.loadPosts();
                }
            },

            // 1. FETCH ALL POSTS
            loadPosts: async () => {
                const grid = document.getElementById('posts-grid');
                const loader = document.getElementById('loader');
                
                loader.classList.remove('hidden');
                grid.innerHTML = '';

                try {
                    const res = await fetch(`${API_BASE_URL}/blog/`);
                    if(!res.ok) throw new Error("Failed to fetch");
                    const posts = await res.json();
                    
                    loader.classList.add('hidden');

                    if(posts.length === 0) {
                        grid.innerHTML = `<div class="col-span-full text-center text-gray-400">No articles published yet.</div>`;
                        return;
                    }

                    posts.forEach(post => {
                        // Create Card
                        const date = new Date(post.created_at).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                        // Strip markdown for preview
                        const previewText = post.content.replace(/[#*_`]/g, '').substring(0, 100) + '...';
                        const coverImg = post.cover_image ? `<img src="${post.cover_image}" class="w-full h-48 object-cover group-hover:scale-105 transition duration-500" onerror="this.style.display='none'">` : `<div class="w-full h-48 bg-emerald-100 flex items-center justify-center text-emerald-300"><i class="fas fa-image text-4xl"></i></div>`;

                        const card = `
                            <div onclick="router.goPost('${post.slug}')" class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer group hover:shadow-xl hover:-translate-y-1 transition duration-300">
                                <div class="overflow-hidden">
                                    ${coverImg}
                                </div>
                                <div class="p-6">
                                    <div class="flex items-center justify-between mb-3">
                                        <span class="text-xs font-bold text-emerald-600 uppercase tracking-wider">${post.tags[0] || 'Article'}</span>
                                        <span class="text-xs text-gray-400">${date}</span>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-3 group-hover:text-emerald-700 transition leading-tight">${post.title}</h3>
                                    <p class="text-gray-500 text-sm mb-4 line-clamp-3">${previewText}</p>
                                    <div class="flex items-center text-emerald-600 font-bold text-sm">
                                        Read Article <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition"></i>
                                    </div>
                                </div>
                            </div>
                        `;
                        grid.innerHTML += card;
                    });

                } catch (err) {
                    loader.classList.add('hidden');
                    grid.innerHTML = `<div class="col-span-full text-center text-red-400">Failed to load articles. Server might be sleeping.</div>`;
                }
            },

            // 2. FETCH SINGLE POST
            loadSinglePost: async (slug) => {
                const container = document.getElementById('view-article');
                
                // Show skeletons/loading state if needed, or clear previous
                document.getElementById('article-title').innerText = "Loading...";
                document.getElementById('article-content').innerHTML = "";

                try {
                    const res = await fetch(`${API_BASE_URL}/blog/${slug}`);
                    if(!res.ok) throw new Error("Post not found");
                    const post = await res.json();

                    // Update URL hash without refreshing
                    window.history.pushState(null, null, `#${slug}`);

                    // Populate Data
                    document.getElementById('article-title').innerText = post.title;
                    document.getElementById('article-date').innerHTML = `<i class="far fa-calendar mr-2"></i> ${new Date(post.created_at).toLocaleDateString('en-US', { dateStyle: 'long' })}`;
                    document.getElementById('article-views').innerHTML = `<i class="far fa-eye mr-2"></i> ${post.views} Views`;
                    
                    // Render Markdown
                    document.getElementById('article-content').innerHTML = marked.parse(post.content);

                    // Cover Image
                    const coverDiv = document.getElementById('article-cover');
                    if(post.cover_image) {
                        coverDiv.innerHTML = `<img src="${post.cover_image}" class="w-full h-full object-cover">`;
                        coverDiv.classList.remove('hidden');
                    } else {
                        coverDiv.classList.add('hidden');
                    }

                    // Tags
                    const tagsContainer = document.getElementById('article-tags');
                    tagsContainer.innerHTML = '';
                    post.tags.forEach(tag => {
                        tagsContainer.innerHTML += `<span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs font-bold uppercase hover:bg-emerald-100 hover:text-emerald-700 transition cursor-default">#${tag}</span>`;
                    });

                } catch (err) {
                    document.getElementById('article-title').innerText = "404 - Article Not Found";
                    document.getElementById('article-content').innerHTML = "<p>The article you are looking for does not exist or has been removed.</p>";
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', app.init);
        
        // Handle Browser Back Button
        window.onpopstate = () => {
            const hash = window.location.hash.substring(1);
            if(hash) router.goPost(hash);
            else router.goHome();
        };

    </script>
</body>
</html>